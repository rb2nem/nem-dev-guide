<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.20.6" />
    <meta name="description" content="Resources for using and developing on NEM">
<meta name="author" content="Nem Project">

    <link rel="shortcut icon" href="https://rb2nem.github.io/nem-dev-guide/images/favicon.png" type="image/x-icon" />

    
    <title>Debugging</title>
    <link href="https://rb2nem.github.io/nem-dev-guide//css/nucleus.css" rel="stylesheet">
    <link href="https://rb2nem.github.io/nem-dev-guide//css/font-awesome.min.css" rel="stylesheet">
    <link href="https://rb2nem.github.io/nem-dev-guide//css/hybrid.css" rel="stylesheet">
    <link href="https://rb2nem.github.io/nem-dev-guide//css/featherlight.min.css" rel="stylesheet">
    <link href="https://rb2nem.github.io/nem-dev-guide//css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="https://rb2nem.github.io/nem-dev-guide//css/horsey.css" rel="stylesheet">
    <link href="https://rb2nem.github.io/nem-dev-guide//css/theme.css" rel="stylesheet">
    <link href="https://rb2nem.github.io/nem-dev-guide//css/hugo-theme.css" rel="stylesheet">
    <script src="https://rb2nem.github.io/nem-dev-guide//js/jquery-2.x.min.js"></script>
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    <link rel="stylesheet" type="text/css" href="https://rb2nem.github.io/nem-dev-guide/css/ansi.css">
<link rel="stylesheet" type="text/css" href="https://rb2nem.github.io/nem-dev-guide/css/custom.css">

  </head>
  <body class="" data-url="/80-debugging/">
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://nem.io">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="505px" height="140px" viewBox="0 0 3000 768" enable-background="new 0 0 1024 768" xml:space="preserve">
<g>
	<path d="M843.539,452.711c-0.433-0.236-0.801-0.424-1.157-0.633c-46.801-27.406-82.187-72.52-96.589-126.548
		c-2.278-8.547-3.988-17.208-5.161-25.978c-1.185-8.855-1.769-17.749-1.846-26.679c-0.013-1.536-0.151-1.286,1.163-2.032
		c17.586-9.983,36.219-17.286,55.92-21.864c7.273-1.69,14.614-2.992,22.024-3.893c10.196-1.24,20.431-1.749,30.699-1.491
		c5.752,0.144,11.49,0.515,17.215,1.125c28.694,3.059,55.605,11.685,80.752,25.83c0.363,0.204,0.715,0.431,1.089,0.614
		c0.426,0.208,0.617,0.519,0.595,0.994c-0.023,0.499-0.003,1-0.01,1.5c-0.075,5.17-0.279,10.335-0.71,15.488
		c-0.62,7.399-1.611,14.748-3.013,22.04c-3.009,15.659-7.736,30.782-14.241,45.342c-10.328,23.117-24.394,43.687-42.161,61.724
		c-12.825,13.02-27.114,24.17-42.852,33.463C844.717,452.031,844.176,452.341,843.539,452.711z M748.408,277.983
		c0,0.492,0,0.865,0,1.238c0.006,7.344,0.485,14.66,1.363,21.949c0.792,6.582,1.936,13.106,3.418,19.569
		c0.262,1.14,0.615,2.23,1.116,3.296c8.973,19.098,29.765,29.253,50.382,24.586c15.721-3.559,28.457-15.674,32.831-31.182
		c1.21-4.288,1.622-8.671,1.758-13.095c0.09-2.922,0.364-5.82,0.912-8.693c3.354-17.568,15.104-32.083,31.559-38.969
		c0.922-0.386,1.863-0.726,2.791-1.097c0.131-0.052,0.342-0.069,0.28-0.31c-2.584-0.922-18.114-2.471-27.428-2.654
		c-19.984-0.394-39.567,2.232-58.718,7.973C774.606,264.81,761.214,270.59,748.408,277.983z M895.88,397.8
		c0.549-0.258,0.764-0.681,1.039-1.023c4.029-5.004,7.794-10.2,11.284-15.594c12.539-19.381,21.288-40.339,26.164-62.908
		c1.657-7.668,2.824-15.409,3.51-23.224c0.467-5.319,0.728-10.645,0.731-15.984c0-0.368-0.037-0.736-0.057-1.102
		c-0.519-0.305-0.98-0.587-1.45-0.852c-4.103-2.315-8.279-4.49-12.548-6.482c-6.157-2.872-12.401-5.531-18.893-7.567
		c-7.902-2.477-15.885-2.753-23.937-0.811c-22.921,5.527-37.569,27.962-33.229,51.127c2.406,12.845,9.297,22.754,20.348,29.75
		c0.739,0.468,1.495,0.91,2.242,1.367c8.074,4.941,14.401,11.558,18.921,19.87c4.753,8.742,6.891,18.096,6.341,28.043
		C896.25,394.154,896.048,395.892,895.88,397.8z M843.611,442.505c0.41-0.232,0.881-0.49,1.343-0.762
		c12.597-7.408,24.162-16.183,34.771-26.227c0.677-0.641,1.2-1.382,1.619-2.204c0.68-1.337,1.372-2.669,2.023-4.021
		c5.02-10.435,6.096-21.246,2.766-32.359c-6.474-21.606-27.306-34.004-48.165-31.397c-5.96,0.745-11.538,2.643-16.738,5.564
		c-9.94,5.584-20.541,7.885-31.883,6.801c-5.565-0.532-10.898-1.954-16.014-4.199c-4.029-1.768-7.769-4.018-11.242-6.718
		c-0.242-0.188-0.514-0.336-0.964-0.628c0.149,0.496,0.21,0.77,0.312,1.029c4.455,11.367,9.974,22.194,16.535,32.49
		c7.082,11.114,15.234,21.381,24.444,30.806c9.211,9.425,19.292,17.806,30.234,25.149
		C837.466,439.057,842.13,441.906,843.611,442.505z"/>
	<path fill="#F7A800" d="M748.408,277.983c12.806-7.392,26.198-13.173,40.263-17.389c19.151-5.741,38.735-8.367,58.718-7.973
		c9.314,0.184,24.844,1.732,27.428,2.654c0.062,0.241-0.149,0.257-0.28,0.31c-0.928,0.37-1.869,0.711-2.791,1.097
		c-16.455,6.886-28.205,21.401-31.559,38.969c-0.548,2.873-0.823,5.771-0.912,8.693c-0.136,4.424-0.548,8.807-1.758,13.095
		c-4.374,15.508-17.11,27.623-32.831,31.182c-20.617,4.667-41.408-5.488-50.382-24.586c-0.501-1.067-0.854-2.156-1.116-3.296
		c-1.482-6.464-2.626-12.987-3.418-19.569c-0.877-7.289-1.357-14.605-1.363-21.949C748.408,278.848,748.408,278.474,748.408,277.983
		z"/>
	<path fill="#67B2E8" d="M895.88,397.8c0.168-1.908,0.37-3.646,0.466-5.389c0.55-9.947-1.587-19.301-6.341-28.043
		c-4.52-8.313-10.847-14.929-18.921-19.87c-0.746-0.457-1.502-0.899-2.242-1.367c-11.051-6.996-17.942-16.905-20.348-29.75
		c-4.34-23.165,10.309-45.6,33.229-51.127c8.052-1.942,16.035-1.666,23.937,0.811c6.492,2.035,12.737,4.694,18.893,7.567
		c4.269,1.992,8.445,4.167,12.548,6.482c0.47,0.265,0.931,0.547,1.45,0.852c0.02,0.365,0.058,0.733,0.057,1.102
		c-0.003,5.339-0.264,10.665-0.731,15.984c-0.686,7.815-1.854,15.556-3.51,23.224c-4.876,22.569-13.625,43.527-26.164,62.908
		c-3.49,5.394-7.255,10.59-11.284,15.594C896.644,397.119,896.429,397.542,895.88,397.8z"/>
	<path fill="#00C4B3" d="M843.611,442.505c-1.481-0.599-6.145-3.447-10.959-6.678c-10.943-7.343-21.023-15.724-30.234-25.149
		c-9.211-9.425-17.363-19.691-24.444-30.806c-6.56-10.296-12.079-21.122-16.535-32.49c-0.101-0.259-0.163-0.533-0.312-1.029
		c0.451,0.292,0.723,0.44,0.964,0.628c3.473,2.7,7.214,4.95,11.242,6.718c5.116,2.246,10.449,3.668,16.014,4.199
		c11.342,1.084,21.943-1.217,31.883-6.801c5.201-2.921,10.778-4.819,16.738-5.564c20.859-2.607,41.691,9.792,48.165,31.397
		c3.33,11.113,2.254,21.924-2.766,32.359c-0.65,1.352-1.343,2.684-2.023,4.021c-0.418,0.822-0.942,1.564-1.619,2.204
		c-10.609,10.044-22.175,18.819-34.771,26.227C844.492,442.015,844.021,442.273,843.611,442.505z"/>
	<path d="M75.119,348.956h49.132v24.767c2.798-3.687,5.87-7.217,9.212-10.582c3.339-3.362,7.056-6.342,11.152-8.949
		c4.09-2.605,8.616-4.666,13.575-6.187c4.955-1.521,10.556-2.282,16.808-2.282c18.746,0,33.236,5.712,43.473,17.131
		c10.233,11.423,15.353,27.151,15.353,47.19v112.161h-49.13v-96.408c0-11.606-2.587-20.369-7.757-26.277
		c-5.172-5.91-12.501-8.87-21.981-8.87c-9.484,0-16.97,2.96-22.465,8.87c-5.493,5.908-8.242,14.671-8.242,26.277v96.408H75.119
		V348.956z"/>
	<path d="M354.988,526.084c-12.928,0-24.945-2.157-36.039-6.464c-11.102-4.309-20.687-10.45-28.767-18.425
		c-8.082-7.969-14.385-17.398-18.909-28.283c-4.526-10.879-6.789-22.999-6.789-36.363v-0.646c0-12.282,2.101-23.919,6.302-34.907
		c4.204-10.99,10.072-20.576,17.618-28.767c7.54-8.188,16.535-14.652,26.99-19.394c10.448-4.738,22.029-7.112,34.747-7.112
		c14.435,0,26.934,2.585,37.494,7.757c10.556,5.172,19.34,12.12,26.344,20.849c7,8.726,12.172,18.748,15.515,30.059
		c3.339,11.312,5.011,23.112,5.011,35.394c0,1.939-0.056,3.99-0.161,6.141c-0.112,2.157-0.273,4.419-0.484,6.789H313.293
		c2.368,11.206,7.271,19.667,14.706,25.373c7.435,5.712,16.647,8.565,27.637,8.565c8.186,0,15.515-1.397,21.979-4.202
		c6.466-2.798,13.141-7.323,20.041-13.576l28.12,24.889c-8.192,10.131-18.1,18.05-29.736,23.759
		C384.404,523.226,370.716,526.084,354.988,526.084z M386.666,422.004c-1.511-10.989-5.39-19.879-11.636-26.666
		c-6.253-6.789-14.546-10.183-24.889-10.183c-10.345,0-18.698,3.345-25.05,10.022c-6.358,6.681-10.506,15.626-12.445,26.827H386.666
		z"/>
	<path d="M465.163,348.956h49.132v24.767c2.798-3.687,5.87-7.217,9.212-10.582c3.339-3.362,7.056-6.342,11.152-8.949
		c4.09-2.605,8.67-4.666,13.737-6.187c5.061-1.521,10.717-2.282,16.97-2.282c11.419,0,21.277,2.388,29.575,7.161
		c8.294,4.778,14.708,11.61,19.232,20.51c7.54-9.111,15.945-16.005,25.212-20.671c9.264-4.666,19.824-7,31.677-7
		c18.313,0,32.646,5.39,42.989,16.161c10.345,10.779,15.517,26.617,15.517,47.515v112.806h-49.132v-96.408
		c0-11.606-2.479-20.369-7.435-26.277c-4.959-5.91-12.071-8.87-21.333-8.87c-9.268,0-16.541,2.96-21.819,8.87
		c-5.282,5.908-7.919,14.671-7.919,26.277v96.408h-49.13v-96.408c0-11.606-2.479-20.369-7.435-26.277
		c-4.959-5.91-12.071-8.87-21.333-8.87c-9.268,0-16.541,2.96-21.819,8.87c-5.282,5.908-7.919,14.671-7.919,26.277v96.408h-49.132
		V348.956z"/>
</g>
</svg>
</a>

    </div>
    
</div>


  <div class="highlightable">
    <ul class="topics">
      
      
        
      
      
      
      

      
        
      
      
      

      <li class="dd-item  parent" data-nav-id="/">
        <a href="https://rb2nem.github.io/nem-dev-guide/">
          <span>
            
              <b>NEM Developer's Guide</b>
            
             NEM&#39;s Developer Guide
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/01-intro/">
              <a href="https://rb2nem.github.io/nem-dev-guide/01-intro/">
                <span>Introduction     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/02-about/">
              <a href="https://rb2nem.github.io/nem-dev-guide/02-about/">
                <span>About this guide     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/03-setting-up-environment/">
              <a href="https://rb2nem.github.io/nem-dev-guide/03-setting-up-environment/">
                <span>Setting up the environment     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/03b-accounts/">
              <a href="https://rb2nem.github.io/nem-dev-guide/03b-accounts/">
                <span>NEM Accounts     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/04-blockchain-requests/">
              <a href="https://rb2nem.github.io/nem-dev-guide/04-blockchain-requests/">
                <span>Blockchain requests     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/04b-account-requests/">
              <a href="https://rb2nem.github.io/nem-dev-guide/04b-account-requests/">
                <span>Account requests     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/05-transaction-overview/">
              <a href="https://rb2nem.github.io/nem-dev-guide/05-transaction-overview/">
                <span>Transactions Overview     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/06-transaction-transfer/">
              <a href="https://rb2nem.github.io/nem-dev-guide/06-transaction-transfer/">
                <span>Transfer Transactions     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item active" data-nav-id="/80-debugging/">
              <a href="https://rb2nem.github.io/nem-dev-guide/80-debugging/">
                <span>Debugging     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/90-snippets/">
              <a href="https://rb2nem.github.io/nem-dev-guide/90-snippets/">
                <span>Code snippets     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/99-references/">
              <a href="https://rb2nem.github.io/nem-dev-guide/99-references/">
                <span>References     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
    </ul>
    <hr>
     
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
                
                
                
              <div id="top-github-link">
                  <a class="github-link" href="https://github.com/rb2nem/nem-dev-guide/edit/master/website/content/80-debugging.md" target="blank">
                    <i class="fa fa-code-fork"></i>
                    Edit this page
                  </a>
              </div>
                
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>
                
                
                
                
                  
                
                <span itemprop="title"> Debugging</span>
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#debugging-rest-api-requests">Debugging REST API requests</a></li>
<li><a href="#debugging-websockets">Debugging Websockets</a>
<ul>
<li><a href="#with-google-chrome">With Google Chrome</a></li>
<li><a href="#with-wireshark">With Wireshark</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

              

            </div>
            
    	        <div id="body-inner">
                
                <h1>Debugging</h1>
                



<h2 id="debugging-rest-api-requests">Debugging REST API requests</h2>

<p>The docker environment accompanying this guide provides <a href="http://docs.mitmproxy.org/en/stable/mitmweb.html">mitmweb</a> to inspect requests sent to
the NIS instance running in the container. This section will show how to use it.</p>

<p>We will send requests to out NIS in the <a href="http://www.ruby-lang.org">ruby language</a>, using the <a href="http://www.rubydoc.info/github/rest-client/rest-client">rest-client gem</a>.
We will try to get the block at the current height, which, as we have already seen, is obtained by sending a POST request to <code>/block/public/at</code> with
a JSON payload telling the height of the block we want to retrieve.</p>

<p>According to the documentation of rest-client this is done easily. We will do it in the interactive ruby interpreter that can be
started with the command <code>irb</code> in the tools container. Once in the interpreter, we type</p>

<pre><code class="language-ruby">require 'rest-client'
RestClient.post 'http://localhost:7890/block/at/public', {'height': '243'}
</code></pre>

<p>This however returns an error message:</p>

<pre><code>RestClient::InternalServerError: 500 Internal Server Error
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/abstract_response.rb:223:in `exception_with_response'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/abstract_response.rb:103:in `return!'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/request.rb:809:in `process_result'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/request.rb:725:in `block in transmit'
	from /usr/lib/ruby/2.3.0/net/http.rb:853:in `start'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/request.rb:715:in `transmit'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/request.rb:145:in `execute'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/request.rb:52:in `execute'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient.rb:71:in `post'
	from (irb):2
	from /usr/bin/irb:11:in `&lt;main&gt;'
</code></pre>

<p>This error message is not very helpful, so we might want to take a look at the mitmweb page available at <a href="http://localhost:8081">http://localhost:8081</a>
after you start containers with the script <code>ndev</code> <a href="https://rb2nem.github.io/nem-dev-guide/03-setting-up-environment">as explained ealier</a>.</p>

<p>Opening Mitmweb in your browser (use Firefox if you get a blank page in Google Chrome), and selecting the last request in the list,
you should see a page similar to this:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_mitmweb_overview.png" />
    
    
    <figcaption>
        <h4>Mitmweb Overview</h4>
        
    </figcaption>
    
</figure>
</p>

<p>The left pane lists the requests it has been intercepted (2 in this case), and
the right pane gives you a detailed view of the request and response headers.
The User-Agent header shows this request has been sent by rest-client to the
host nemdevnis (the container running our NIS instance) with a content type
header <code>application/x-www-form-urlencoded</code>.</p>

<p>Clicking on the Response link of the right tab shows this:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_mitmweb_step1_response.png" />
    
    
    <figcaption>
        <h4>Response Headers</h4>
        
    </figcaption>
    
</figure>

This is already mugh more informative. It means our request sent its data in an encoding not supported
by the server.</p>

<p>We can fix this by setting the content type header to json and ensure we send a json payload:</p>

<pre><code class="language-ruby">require 'rest-client'
require 'json'
RestClient.post 'http://localhost:7890/block/at/public', {'height': '243'}.to_json, {content_type: :json, accept: :json}
</code></pre>

<p>This still yields an error in  ruby, which is not much clearer:</p>

<pre><code>RestClient::InternalServerError: 500 Internal Server Error
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/abstract_response.rb:223:in `exception_with_response'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/abstract_response.rb:103:in `return!'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/request.rb:809:in `process_result'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/request.rb:725:in `block in transmit'
	from /usr/lib/ruby/2.3.0/net/http.rb:853:in `start'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/request.rb:715:in `transmit'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/request.rb:145:in `execute'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient/request.rb:52:in `execute'
	from /var/lib/gems/2.3.0/gems/rest-client-2.0.2/lib/restclient.rb:71:in `post'
	from (irb):10
	from /usr/bin/irb:11:in `&lt;main&gt;'
</code></pre>

<p>
<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_mitmweb_response_property_value.png" />
    
    
    <figcaption>
        <h4>Wrong Property Value Response</h4>
        
    </figcaption>
    
</figure>

It reports a incompatible value for the property height. Looking at the request details, we have:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_mitmweb_request_details.png" />
    
    
    <figcaption>
        <h4>Request details</h4>
        
    </figcaption>
    
</figure>

We see at the bottom that the text passed as value is valid JSON. If we don&rsquo;t see what&rsquo;s wrong here,
we can send the same request with a tool that gave a succesful response. In our case, this is <a href="https://rb2nem.github.io/nem-dev-guide/04-blockchain-requests/#getting-a-block-at-height-post-block-at-public">a request
we already sent</a> with httpie.
We know that issuing the command <code>http :7890/block/at/public height:=243</code> yields a successful result.
Let&rsquo;s just issue that command and look at the request headers. Here are the details of the request sent by
httpie:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_mitmweb_httpie_request.png" />
    
    
    <figcaption>
        <h4>Successful request with httpie</h4>
        
    </figcaption>
    
</figure>

Did you spot the difference? Httpie sent</p>

<pre><code class="language-json">{
    &quot;height&quot;: 243
}
</code></pre>

<p>while with rest-client we sent:</p>

<pre><code class="language-json">{
    &quot;height&quot;: &quot;243&quot;
}
</code></pre>

<p>We send the value of the <code>height</code> property as a string, whereas it should be an integer.
Let&rsquo;s see if this fixes our problem:</p>

<pre><code class="language-ruby">require 'rest-client'
require 'json'
resp=RestClient.post 'http://localhost:7890/block/at/public', {'height': 243}.to_json, {content_type: :json, accept: :json}
=&gt; &lt;RestClient::Response 200 &quot;{\&quot;timeStamp...&quot;&gt;
</code></pre>

<p>Sure enough! We now successfully debugged and sent a request from Ruby.</p>

<h2 id="debugging-websockets">Debugging Websockets</h2>

<p>Debugging websockets is not as accessible as debugging your HTTP requests. There&rsquo;s no perfect solution, and we will debug
websocket connections with the Google Chrome console, as well as with Wireshark. None of these is great to debug websockets,
but combining both tools might help you get forward.</p>

<p>In this section, we will not open websocket connections ourselves, but we will see how to observe the traffic on the websocket
connections opened by the NanoWallet.</p>

<h3 id="with-google-chrome">With Google Chrome</h3>

<p>You can open the Google Chrome inspctor by pressing CTRL-SHIFT-I. In the Inspector, select the <code>Network</code> tab (surrounded in screenshot), and select to only
display websockets by clicking on <code>WS</code> (indicated by the red arrow in the screenshot).
If you open the inpector on a page that is loaded, you will have to reload the page as indicated:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_chrome_inspector.png" />
    
    
    <figcaption>
        <h4>Chrome Inspector Overview</h4>
        
    </figcaption>
    
</figure>
</p>

<p>When you login to the NanoWallet with the Inspector open and with the filter displaying only websocket connections, you will see
a websocket connection established:</p>


<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_ws_open.png" />
    
    
    <figcaption>
        <h4>Websocket Connection opened</h4>
        
    </figcaption>
    
</figure>


<p>By selecting the connection in the list, you can take a closer look to the connection. By default,
the detailed view of the connection open on the headers tab showing all headers of the connection, both for request and response:</p>


<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_ws_headers.png" />
    
    
    <figcaption>
        <h4>Websocket Connection Headers</h4>
        
    </figcaption>
    
</figure>


<p>The websocket connection is a persistent connection over which multiple data frames are exchanged. Luckily, the inspector lets
us take a close look at the frames exchanged. Selecting the Frames tab gives you a list of frames exchanged over the connection.
This list is updated automatically as new frames are exchanged:</p>


<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_ws_frames.png" />
    
    
    <figcaption>
        <h4>Websocket Connection Frames</h4>
        
    </figcaption>
    
</figure>


<p>Let&rsquo;s focus a bit on the frames list after opening a wallet in the NanoWallet client:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_ws_frames_list.png" />
    
    
    <figcaption>
        <h4>Websocket Connection Frames List</h4>
        
    </figcaption>
    
</figure>
</p>

<p>Outgoing messages have a light-green background, incoming messages have a white background. WebSocket opcodes are light-yellow
and errors are light-red (from the <a href="https://developers.google.com/web/tools/chrome-devtools/network-performance/reference#frames">Google Chrome documentation</a>).</p>

<p>We see that we send a frame to connected, and we get confirmation that we have successfully connected.</p>

<p>After that, the NanoWallet client subscribes to multiple notifications. We see a total of 9 subscriptions
(sub-0 to sub-9) for information regarding the account <code>TA6XFSJYZYAIYP7FL7X2RL63647FRMB65YC6CO3G</code> like
transactions, mosaics, namespaces. There are also global subscriptions for errors and new blocks. Subscription
related information have been highlighted in red in the screenshot.</p>

<p>In addition to subscriptions, some other frames are sent to request information about the account. Subscriptions
will only get messages sent when an update is available, but the NanoWallet client needs to retrieve that information
to display the current status of the account. This is done by sending SEND command messages. The information regarding these
requests are highlighted in blue in the screenshot. We see that the information requested covers the account details,
the transactions of that account, as well as the mosaics and namespaces.</p>

<p>Following that are some frames received in relation with the 9 subscriptions just created. The first MESSAGE
received is part of <code>sub-0</code></p>

<p>Selecting a frame in that list will display its content:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_ws_details.png" />
    
    
    <figcaption>
        <h4>Websocket Frame Details</h4>
        
    </figcaption>
    
</figure>
</p>

<p>But here is the result is far from great. The frame&rsquo;s content is just displayed on one line, which does not ease
reading and analysing the frame&hellip;.</p>

<p>Advanced socket information can be gathered from the Google Chrome internal socket details available
at <a href="chrome://net-internals/#sockets">chrome://net-internals/#sockets</a>, but this is out of scope for this guide.</p>

<h3 id="with-wireshark">With Wireshark</h3>

<p>The container nis container provided with this guide automatically collects traces of the network traffic to and from
the NIS instance it runs. The traces are stored in the <code>traces</code> subdirectory of the directory you configured as the location
for the persistent data. See the variable <code>persistent_location</code> in the file <code>settings.sh</code> in the same location as the <code>ndev</code>
executable used to control the containers.</p>

<p>Two traces are captured: <code>nis.pcap</code> for traffic on port 7890 (http requests) and <code>ws.pcap</code> for traffic on port 7778 (websockets).
We will use the ws.pcap file to observe websocket traffic.</p>

<p>A great tool to analyse the traces captured is <a href="https://www.wireshark.org/">Wireshark</a>, and this is what we will use.
It is free software, available for Linux, Mac and Windows.</p>

<p>When you start Wireshark, you will not start a live capture but open the existing capture file available in the persistent
location you configured. But as that file is continuously updated, you will git this error:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_wireshark_truncated_file.png" />
    
    
    <figcaption>
        <h4>Wireshark Warning</h4>
        
    </figcaption>
    
</figure>
</p>

<p>This is not a problem for our analysis, it just means that we have openen a file in which the last packet was not completely
written to disk. All packets in the trace are usable though, and will give us a detailed view on the websocket traffic.</p>

<p>When you open the traces file, you get something like this:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_wireshark_overview.png" />
    
    
    <figcaption>
        <h4>Wireshark window</h4>
        
    </figcaption>
    
</figure>

Each line is a TCP packet, and aggregated views for supported protocols (like HTTP, websocket, etc)  also have a line displayed.
We are only interested in websocket traffic, so we can filter to only display the lines of interest. Enter <code>websocket</code> in the
text field at the top of the list and press enter:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_wireshark_websocket_filter.png" />
    
    
    <figcaption>
        <h4>Wireshark filter</h4>
        
    </figcaption>
    
</figure>

This result in the list only displaying websocket protocol information, offering a higher level view than the TCP packets,
in which we are not interested for our analysis.</p>

<p>As in our analysis with Google Chrome, we see the CONNECT packet sent by our browser:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_wireshark_connect.png" />
    
    
    <figcaption>
        <h4>Websocket CONNECT</h4>
        
    </figcaption>
    
</figure>

We know that this frame is sent by our client, so we deduce that the server address is 172.18.0.3, and the client address
is 172.18.0.2.
Following by the CONNECT request, we receive a CONNECTED message confirming our websocket connection is successfully established:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_wireshark_connected.png" />
    
    
    <figcaption>
        <h4>Websocket CONNECTED</h4>
        
    </figcaption>
    
</figure>
</p>

<p>We also see the subscription request being sent:</p>


<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_wireshark_subscribe_one.png" />
    
    
    <figcaption>
        <h4>Websocket Connection Frames List</h4>
        
    </figcaption>
    
</figure>


<p>The first request is displayed individually, but the other subscription requests are grouped in one entry:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_wireshark_subscribe_multiple.png" />
    
    
    <figcaption>
        <h4>Websocket Connection Frames List</h4>
        
    </figcaption>
    
</figure>
</p>

<p>After that are the SEND command sent by the client:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_wireshark_send.png" />
    
    
    <figcaption>
        <h4>Websocket SEND commands</h4>
        
    </figcaption>
    
</figure>

and the MESSAGEs received from the server:

<figure >
    
        <img src="https://rb2nem.github.io/nem-dev-guide/images/debugging_wireshark_message.png" />
    
    
    <figcaption>
        <h4>Websocket MESSAGE answers</h4>
        
    </figcaption>
    
</figure>
</p>

<p>But here again, the display is not perfect, but this description should help you get up to speed regarding the debugging of
your websocket requests.</p>


      
      </div>
    </div>

    <div id="navigation">
        
        <a class="nav nav-prev" href="https://rb2nem.github.io/nem-dev-guide//06-transaction-transfer"> <i class="fa fa-chevron-left"></i></a>
        <a class="nav nav-next" href="https://rb2nem.github.io/nem-dev-guide/90-snippets" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://rb2nem.github.io/nem-dev-guide//js/clipboard.min.js"></script>
    <script src="https://rb2nem.github.io/nem-dev-guide//js/perfect-scrollbar.min.js"></script>
    <script src="https://rb2nem.github.io/nem-dev-guide//js/perfect-scrollbar.jquery.min.js"></script>
    <script src="https://rb2nem.github.io/nem-dev-guide//js/jquery.sticky-kit.min.js"></script>
    <script src="https://rb2nem.github.io/nem-dev-guide//js/featherlight.min.js"></script>
    <script src="https://rb2nem.github.io/nem-dev-guide//js/html5shiv-printshiv.min.js"></script>
    <script src="https://rb2nem.github.io/nem-dev-guide//js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://rb2nem.github.io/nem-dev-guide//js/modernizr.custom.71422.js"></script>
    <script src="https://rb2nem.github.io/nem-dev-guide//js/learn.js"></script>
    <script src="https://rb2nem.github.io/nem-dev-guide//js/hugo-learn.js"></script>
    
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-96593681-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


  </body>
</html>

